<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Rank Residency Positions</title>
    <style>
        #positionsList { list-style: none; padding: 0; }
        #positionsList li {
            margin: 8px 0;
            padding: 12px;
            background: #f0f0f0;
            border: 1px solid #ccc;
            cursor: move;
        }
    </style>
</head>
<body>
    <h2>Rank Residency Positions</h2>
    <form method="post" id="rankForm">
        <ul id="positionsList">
            {% for pos in positions %}
            <li data-id="{{ pos.id }}">
                Company: {{ pos.company_id }}, Year: {{ pos.year }}, Slots: {{ pos.num_of_residencies }}
            </li>
            {% endfor %}
        </ul>
        <input type="hidden" name="position_order" id="positionOrder">
        <button type="submit">Save Rankings</button>
    </form>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script>
        var el = document.getElementById('positionsList');
        var sortable = Sortable.create(el, {
            animation: 150,
            onEnd: function () {
                var order = [];
                el.querySelectorAll('li').forEach(function(li) {
                    order.push(li.getAttribute('data-id'));
                });
                document.getElementById('positionOrder').value = order.join(',');
            }
        });
        document.getElementById('rankForm').onsubmit = function() {
            var order = [];
            el.querySelectorAll('li').forEach(function(li) {
                order.push(li.getAttribute('data-id'));
            });
            document.getElementById('positionOrder').value = order.join(',');
        };
    </script>
</body>
</html>