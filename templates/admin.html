{% extends "base.html" %}

{% block head %}
  <link rel="stylesheet" href="{{ url_for('static', filename='admin.css') }}">
  <style>
    .admin-columns {
      display: flex;
      gap: 40px;
      justify-content: space-between;
      flex-wrap: wrap;
    }
    .admin-section {
      flex: 1;
      min-width: 400px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 8px 10px;
      border-bottom: 1px solid #ccc;
    }
    .flash-messages {
      list-style: none;
      padding-left: 0;
      color: red;
    }
  </style>
{% endblock %}

{% block content %}
<div class="admin-wrapper">
  <div class="glass-container">
    <h2>Admin Panel</h2>

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <ul class="flash-messages">
          {% for message in messages %}
            <li>{{ message }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    <div class="admin-columns">
      <!-- Pending Users -->
      <div class="admin-section">
        <h3>Pending Users</h3>
        {% if pending_users %}
          <table>
            <thead>
              <tr><th>Email</th><th>Role</th><th>Actions</th></tr>
            </thead>
            <tbody>
              {% for user in pending_users %}
                <tr>
                  <td>{{ user.username }}</td>
                  <td>{{ user.role }}</td>
                  <td>
                    <form method="POST" style="display:inline;">
                      <input type="hidden" name="user_email" value="{{ user.username }}">
                      <button type="submit" name="action" value="approve">Approve</button>
                    </form>
                    <form method="POST" style="display:inline;">
                      <input type="hidden" name="user_email" value="{{ user.username }}">
                      <button type="submit" name="action" value="reject">Reject</button>
                    </form>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% else %}
          <p>No users pending approval.</p>
        {% endif %}
      </div>

      <!-- Pending Residency Positions -->
      <div class="admin-section">
        <h3>Pending Residency Positions</h3>
        {% if pending_positions %}
          <table>
            <thead>
              <tr><th>Title</th><th>Company</th><th>Actions</th></tr>
            </thead>
            <tbody>
              {% for pos in pending_positions %}
                <tr>
                  <td>{{ pos.title }}</td>
                  <td>{{ pos.company.name }}</td>
                  <td>
                    <form method="POST" style="display:inline;">
                      <input type="hidden" name="position_id" value="{{ pos.id }}">
                      <button type="submit" name="action" value="approve">Approve</button>
                    </form>
                    <form method="POST" style="display:inline;">
                      <input type="hidden" name="position_id" value="{{ pos.id }}">
                      <button type="submit" name="action" value="reject">Reject</button>
                    </form>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% else %}
          <p>No residency positions pending approval.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

    <button id="show-students" class="admin-button">View All Students</button>
<button id="show-companies" class="admin-button">View All Companies</button>

<!-- Student Table (hidden by default) -->
<div id="student-table" style="display: none;">
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Email</th>
        <th>First Name</th>
        <th>Last Name</th>
        <th>Year</th>
        <th>Grade</th>
      </tr>
    </thead>
    <tbody>
      {% for student in students %}
      {% set user = User.query.get(student.id) %}
      <tr>
        <td>{{ student.id }}</td>
        <td>{{ user.username }}</td>
        <td>{{ student.first_name }}</td>
        <td>{{ student.last_name }}</td>
        <td>{{ student.year }}</td>
        <td>{{ student.grade }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Company Table (hidden by default) -->
<div id="company-table" style="display: none;">
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
          <th>Phone No.</th>
            <th>Email</th>
        <!-- Add other columns if needed -->
      </tr>
    </thead>
    <tbody>
      {% for company in companies %}
       {% set user = User.query.filter_by(company_id=company.id).first() %}
      <tr>
        <td>{{ company.id }}</td>
        <td>{{ company.name }}</td>
          <td>{{ company.contact }}</td>
            <td>{{ user.username}}</td>


      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Run Allocation Button -->
<form action="/run-allocation" method="POST">
  <select name="year" required>
    <option value="1">Year 1</option>
    <option value="2">Year 2</option>
    <option value="3">Year 3</option>
    <option value="4">Year 4</option>
  </select>

    <form method="POST" enctype="multipart/form-data" action="/upload">
  <input type="file" name="file" accept=".csv" required>
  <button type="submit">Run Allocation</button>
</form>

<script>
  document.getElementById('show-students').addEventListener('click', function() {
    document.getElementById('student-table').style.display = 'block';
    document.getElementById('company-table').style.display = 'none';
  });
  document.getElementById('show-companies').addEventListener('click', function() {
    document.getElementById('company-table').style.display = 'block';
    document.getElementById('student-table').style.display = 'none';
  });
</script>

{% endblock %}
